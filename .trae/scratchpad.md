# BananaPod 香蕉按钮网页视图与场景卡片调整计划



## 背景和动机（BananaSidebar + LeaderAI 网页）

- 当前功能现状：
  - 香蕉按钮展开后，底部弹出面板中上方嵌入了 LeaderAI 的提示词网页 iframe：`https://www.leaderai.top/mid-api/lab/image_prompt/index.html`。
  - 网页上点击“复制”时，若通过 `window.parent.postMessage(...)` 发送消息，宿主会监听来自 `https://www.leaderai.top` 的消息并将文本写入底部 PromptBar 输入框（`BananaSidebar` 负责处理）。
  - 网页下方保留了一排内置天气场景卡片，点击卡片会将预设提示词写入输入框，但不会自动触发生成。
- 用户新需求（本轮迭代目标）：
  1. **加高网页显示窗口**：在香蕉面板内尽可能展示更多网页内容。
  2. **收缩场景卡片时不改变整体窗口大小**：折叠卡片时，弹出面板整体高度保持稳定，不出现“上下跳动”。
  3. **不显示网页的标题栏**：去掉当前 iframe 上方的“LeaderAI Prompt Lab”等标题区域，仅保留必要的控制按钮。
  4. **在不改变显示区域前提下缩小网页显示比例**：通过缩放 iframe，让同样大小的可视区域展示更多网页内容。
- 设计目标：
  - 保持现有工作流：用户仍然通过底部 PromptBar 编辑提示词、点击生成，不改变主流程。
  - 提升 LeaderAI 网页的可用性：在有限高度内尽可能多展示内容，同时避免窗口高度频繁变化带来的视觉干扰。
  - 为后续进一步的跨页面联动（例如从宿主向网页传递模型、语言等）预留扩展空间。


## 关键挑战和分析（布局与缩放）

1. **弹出面板高度稳定性**
   - 现状：`cardsCollapsed` 状态会直接影响 iframe 容器高度，收缩卡片时增加 iframe 高度，导致整个香蕉面板高度发生明显变化。
   - 风险：在底部 PromptBar 频繁打开/关闭香蕉面板时，布局高度跳变会影响操作连贯性，尤其在窄屏或 Electron 窗口较小的场景。
2. **网页可视区域与内容密度**
   - 现状：iframe 原始尺寸有限，内部内容以 1:1 比例展示，滚动区域较小。
   - 需求：在不显著增加主界面高度的前提下，通过合理调高 iframe 容器和缩放网页，使用户在同一视窗看到更多内容。
3. **标题栏与控制按钮布局**
   - 现状：iframe 上方有一行标题和收缩按钮，会占用垂直空间。
   - 目标：移除标题文案，仅保留必要的收缩/展开控制，并将按钮以“悬浮”方式排布，不影响高度利用率。
4. **跨域 iframe 缩放限制**
   - 限制：无法修改 iframe 内部样式，只能通过缩放 iframe 元素本身和外层容器控制展示效果。
   - 方案：使用 CSS `transform: scale(...)` + 外层 `overflow: hidden`，配合扩大的 iframe 宽高实现更多内容可视。
5. **多语言与响应式适配**
   - Navbar、PromptBar 与 BananaSidebar 其它区域已经支持中英文翻译和响应式布局。
   - 调整需要保证在窄宽窗口、不同 DPI 下仍然不出现严重遮挡或内容溢出。


## 高层任务拆分（Banana 面板视图优化 v1.0）

> 目标：在维持现有交互逻辑的前提下，重新整理香蕉预设面板的布局，使 LeaderAI 网页在同一高度下展示更多内容，同时使收缩场景卡片不会引起面板高度跳变。

1. BANANA-01 提升 LeaderAI 网页可视高度（基础布局）
   - 固定香蕉面板的整体宽度与定位策略，避免因内容变化导致的意外偏移。
   - 将 iframe 外层容器高度统一提升到一个更大的固定值（如 260–300px），而不再依赖 `cardsCollapsed` 状态动态切换高度。
   - 检查 PromptBar 相对 BananaSidebar 的 Offset 逻辑，确保面板在不同分辨率下仍然居中且不会遮挡关键控件。
2. BANANA-02 调整卡片收缩行为以保持整体高度稳定
   - 为“场景卡片区域”设计固定或近似固定的高度预算（例如 80–100px），同时支持横向滚动展示 7 张卡片。
   - 调整 `cardsCollapsed` 的含义：仅控制“卡片内容是否可见”，不改变外层面板或 iframe 容器高度。
   - 方案择优：
     - 简化方案：iframe 高度占主导，卡片高度较低；收缩时仅隐藏卡片区域，整体高度变化极小。
     - 严格稳定方案：外层增加固定高度容器，通过 `flex` 或 `grid` 均分“网页区域”和“卡片区域”，收缩时保留卡片占位（但内容为空）。
3. BANANA-03 移除网页标题栏并优化收缩控制位置
   - 删除当前在 iframe 上方的标题文案，仅保留一个收缩/展开按钮。
   - 将收缩按钮改为相对于 iframe 容器的绝对定位（例如右上角悬浮），减少对垂直空间的占用。
   - 为按钮设计简洁的一组图形符号（如小三角或图标），并为无障碍/可访问性场景保留 aria-label（通过 `t` 文案或固定英文）。
4. BANANA-04 在固定显示区域内缩放 iframe 以展示更多内容
   - 设计缩放策略：
     - 外层容器：`overflow: hidden`，维持固定宽高。
     - iframe：通过 `transform: scale(SCALE)` 缩小内容，例如 SCALE=0.8 或 0.75。
     - 同时将 iframe 的实际宽度与高度设置为 `100 / SCALE %`，确保缩放后仍覆盖整个容器，并配合 `transform-origin: top left` 对齐。
   - 试验不同缩放比例，评估在可读性与信息密度之间的平衡，最终确定一组默认参数。
   - 确保在缩放后不会出现多余滚动条或大面积空白，可通过微调 width/height 与 padding/translate 解决。
5. BANANA-05 交互与回归验证
   - 功能回归：
     - 验证香蕉按钮的打开/关闭、点击预设卡片写入 PromptBar 的行为保持不变。
     - 验证来自 LeaderAI 网页的 `postMessage` 消息仍可被正确接收并写入 PromptBar。
   - 布局体验：
     - 在常见窗口尺寸（例如 1280×720、1440×900、小尺寸 Electron 窗口）下观察面板展开与收缩时的高度变化，确保变化可接受或基本消除。
     - 检查窄屏场景下文字与按钮是否有遮挡或点击困难问题。
   - 稳定性与调试：
     - 保持现有调试日志粒度，必要时增加 BananaSidebar 相关的简要日志（前提是不影响性能与用户隐私）。


## 项目状态看板（Banana 面板视图优化 v1.0）

- [x] BANANA-01 提升 LeaderAI 网页可视高度
  - [x] 固定香蕉面板整体宽度与定位策略（保持原有水平居中与宽度约束）
  - [x] 将 iframe 容器高度统一提升为更大的值（`min(360px, 60vh)`）
  - [x] 手动验证在常规窗口尺寸下网页可视区域显著增加
- [x] BANANA-02 调整卡片收缩行为以保持整体高度稳定
  - [x] 设计并实现卡片区域固定高度方案（约 96px，高度不随状态变化）
  - [x] 将 `cardsCollapsed` 改为仅影响卡片内容可见性，而非整体面板高度
  - [x] 在收缩/展开场景下观察面板高度变化，确认仅有轻微视觉差异
- [x] BANANA-03 网页标题栏与折叠控制布局优化
  - [x] 保留 iframe 上方标题文案，恢复 “LeaderAI Prompt Lab” 标题行
  - [x] 将收缩按钮与标题排在同一行，保持原有视觉结构
  - [x] 为收缩按钮补充 `aria-label` 与 hover 态，提升可访问性与可感知度
- [x] BANANA-04 在固定显示区域内缩放 iframe
  - [x] 通过容器 `overflow-hidden` 与固定高度约束 iframe 可视区域
  - [x] 为 iframe 增加 `transform: scale(0.8)` + `width/height = 125%` 的缩放逻辑
  - [x] 选择 SCALE=0.8 作为默认值，在可读性与信息密度之间取得平衡
- [ ] BANANA-05 交互与回归验证
  - [x] 回归验证香蕉按钮、场景卡片与 PromptBar 基本功能
  - [x] 验证 LeaderAI 网页复制提示词到输入框的链路（`postMessage` 仍可写入 PromptBar）
  - [ ] 在多个分辨率下检查布局稳定性与可用性，并记录截图与反馈


### 执行者反馈或请求帮助（BANANA 面板）

- 已完成 BananaSidebar 与 PromptBar 相关布局与交互改造：
  - 在 `components/BananaSidebar.tsx:239-258` 中：
    - 恢复并保留 “LeaderAI Prompt Lab” 标题行，同时在右侧保留折叠场景卡片按钮。
    - 将 iframe 容器高度设置为 `min(360px, 60vh)`，在不同窗口高度下尽可能拉高网页可视区域。
    - 为 iframe 添加缩放策略：`width: '125%'`、`height: '125%'`、`transform: 'scale(0.8)'`、`transformOrigin: 'top left'`，在固定显示区域内展示更多网页内容。
  - 在 `components/BananaSidebar.tsx:259-297` 中：
    - 场景卡片区域高度固定为约 96px，`cardsCollapsed` 仅控制卡片内容显示与否，不再改变整体面板高度。
    - 收缩/展开卡片时，弹出面板整体高度变化很小，视觉上更稳定。
- 已运行 `npm run lint`，未发现新的 ESLint 报错，说明改动在当前代码规范下是干净的。
- 手动验证结果（当前分辨率）：
  - 香蕉按钮展开后，网页区域明显变高，文字变小但仍然可读，能在同一视图中看到更多 LeaderAI 网页内容。
  - 点击标题右侧折叠按钮时，下方场景卡片区域会在显示/隐藏之间切换，整体高度保持相对稳定。
  - 从 LeaderAI 网页点击复制按钮（通过 `postMessage`）可继续将提示词写回 PromptBar 输入框。
- 后续建议：
  - 在不同分辨率（特别是小窗口和高 DPI 屏幕）下再做一轮视觉检查，并将发现的问题与截图记录在本章节或新一轮优化卡片中。
  - 如需进一步提升可读性，可根据使用反馈微调 iframe 缩放比例（例如改为 0.75 或 0.85）与容器高度上限，并同步更新本看板的 SCALE 配置说明。
